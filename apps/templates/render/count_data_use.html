{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

{% endblock stylesheets %}

{% block content %}

<header class="header">
    <form class="container-fluid" method="post">
        {% csrf_token %}
        <div class="d-none d-md-flex  gap-3">
            <input type="date" name="date_upload_old" value="{{ current_date_old }}" class="form-control" id="input-date-upload-old" required="">
            <input type="date" name="date_upload_new" value="{{ current_date_new }}" class="form-control" id="input-date-upload-new" required="">

            <div class="col-auto">
                <button type="submit" class="btn btn-primary" name="action" value="Seach">Tìm Kiếm</button>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary"name="action" value="Date-Yesterday">Hôm Qua</button>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary" name="action" value="Date-Today">Hôm Nay</button>
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-primary" name="action" value="Date-Month">Tháng Này</button>
            </div>
        </div>
    </form>
</header>
 
<div class="card ">
    <table class="table table-hover" id="count-data">
        {{data}}
    </table>
    <div class="modal fade" id="exampleModalCenteredScrollable" tabindex="-1" aria-labelledby="exampleModalCenteredScrollableTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenteredScrollableTitle">Thumbnail</h5>
                <input type="hidden" id="use-id-count-image" value="">
                <button class="btn-close" type="button" data-coreui-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row row-cols-1 row-cols-md-3 g-1 justify-content-center h-100" id='image-img'>
                    </div> 
                </div>
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center" id='page-image'>
                       
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    <div class="modal fade" id="exept" tabindex="-1" aria-labelledby="exampleModalCenteredScrollableTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="exampleModalCenteredScrollableTitle">Modal title</h5>
                <input type="hidden" id="use-id-count-title" value="">
                <button class="btn-close" type="button" data-coreui-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" width="300px;">
                    <table class="table table-hover">
                        <thead>
                          <tr>
                            <th scope="col" class="col-1">#</th>
                            <th scope="col" class="col-1 text-center">ID</th>
                            <th scope="col" class="col text-center">Tiêu Đề</th>
                          </tr>
                        </thead>
                        <tbody  id='use-count-title'>
                            
                        </tbody>
                    </table>
                </div>
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center" id='page-title'>
                    </ul>
                </nav>

            </div>
        </div>
    </div>
</div>
{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>
    $(document).on('click', '.show-thumnail', function() {
        var id = $(this).data('id'); // Bổ sung biến id
        var page = 1;
        $('#use-id-count-image').val(id);
        show_image(id, page);
    });

    $(document).on('click', '#page-image .page-link-one', function(e){
        e.preventDefault();
        var url = $(this).attr('href');
        page = url.split('page=')[1];
        id = $('#use-id-count-image').val();
        show_image(id,page);
    });


    
    function show_image(id, page){
        var formData = new FormData(); // Khởi tạo FormData bên trong hàm
        formData.append('id', id);
        formData.append('page', page);
        formData.append('current_date_old', $('#input-date-upload-old').val());
        formData.append('current_date_new', $('#input-date-upload-new').val());
        formData.append('action', 'show-thumnail');
        
        $.ajax({
            url: "{% url 'render:count_data_use' %}",
            type: 'POST',
            headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value},
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response.success === true) {
                    $('#image-img').empty();
                    $('#image-img').html(response.thumnail_html);
                    $('#page-image').empty();
                    $('#page-image').html(response.page_bar_html);
                }
            },
            error: function(error) {
                console.log(error);
            }
        });
    }

    $(document).on('click', '.show-title', function() {
        var id = $(this).data('id'); // Bổ sung biến id
        var page = 1;
        $('#use-id-count-title').val(id);
        show_title(id, page);
    });

    $(document).on('click', '#page-title .page-link-two', function(e) {
        e.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết
        var url = $(this).attr('href');
        var page = url.split('page=')[1];
        var id = $('#use-id-count-title').val();
        show_title(id, page); // Gọi hàm show_image với các tham số id và page
    });
    

    function show_title(id, page){
        var formData = new FormData(); // Khởi tạo FormData bên trong hàm
        formData.append('id', id);
        formData.append('page', page);
        formData.append('current_date_old', $('#input-date-upload-old').val());
        formData.append('current_date_new', $('#input-date-upload-new').val());
        formData.append('action', 'show-title');
        
        $.ajax({
            url: "{% url 'render:count_data_use' %}",
            type: 'POST',
            headers: {'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value},
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                if (response.success === true) {
                    $('#use-count-title').empty();
                    $('#use-count-title').html(response.title_html);
                    $('#page-title').empty();
                    $('#page-title').html(response.page_bar_html);
                }
            },
            error: function(error) {
                console.log(error);
            }
        });
    }
    

</script>
{% endblock javascripts %}

